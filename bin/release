#!/usr/bin/env bash

# DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )/.." && pwd )"

set -e

git checkout dev

rm -rf tmp/releases
mkdir -p tmp/releases

version="2.1.2"

# base ---------------------------------------------------------------------------------------------
cp -r base tmp/releases

cat >tmp/releases/base/base.nimble <<EOL
version     = "${version}"
author      = "Alex Craft https://github.com/al6x"
description = "Extensions for Nim std"
license     = "MIT"

srcDir = "."

requires "nim >= 1.6"
EOL

# ext ----------------------------------------------------------------------------------------------
mkdir tmp/releases/ext
cp -r ext tmp/releases/ext
mv tmp/releases/ext/ext/readme.md tmp/releases/ext

cat >tmp/releases/ext/ext.nimble <<EOL
version     = "${version}"
author      = "Alex Craft https://github.com/al6x"
description = "Extensions for Nim std"
license     = "MIT"

srcDir = "."

requires "nim >= 1.6"
requires "https://github.com/al6x/nim?subdir=base"
EOL

# ftext --------------------------------------------------------------------------------------------
mkdir tmp/releases/ftext
cp -r ftext tmp/releases/ftext
mv tmp/releases/ftext/ftext/readme.md tmp/releases/ftext
mv tmp/releases/ftext/ftext/readme tmp/releases/ftext

cat >tmp/releases/ftext/ftext.nimble <<EOL
version     = "${version}"
author      = "Alex Craft https://github.com/al6x"
description = "Formal Text, Text as Data"
license     = "MIT"

srcDir = "."

requires "nim >= 1.6"
requires "https://github.com/al6x/nim?subdir=ext"
EOL

# mono ---------------------------------------------------------------------------------------------
mkdir tmp/releases/mono
cp -r mono tmp/releases/mono
mv tmp/releases/mono/mono/readme.md tmp/releases/mono
mv tmp/releases/mono/mono/readme tmp/releases/mono

cat >tmp/releases/mono/mono.nimble <<EOL
version     = "${version}"
author      = "Alex Craft https://github.com/al6x"
description = "Mono UI Web Framework"
license     = "MIT"

srcDir = "."

requires "nim >= 1.6"
requires "https://github.com/al6x/nim?subdir=ext"
EOL

# nodem --------------------------------------------------------------------------------------------
mkdir tmp/releases/nodem
cp -r nodem tmp/releases/nodem

cat >tmp/releases/nodem/nodem.nimble <<EOL
version     = "1.4.0"
author      = "Alex Craft http://al6x.com"
description = "Call remote functions as local"
license     = "MIT"

srcDir = "."

requires "nim >= 1.4.2"
EOL

# Switching to releases branch ---------------------------------------------------------------------
git checkout main
# rm -rf ./base
# rm -rf ./ext
# rm -rf ./ftext
# rm -rf ./mono
# rm -rf ./nodem
# mv tmp/releases .
# git add .
# git commit -m "version $version"
# git push
# git checkout dev
# echo "release done, switched back to dev"