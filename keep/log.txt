block: # Grams
  for blk in doc.blocks:
    let ltext = blk.text.to_lower
    ltext.to_bigram_codes blk.bigrams
    ltext.to_trigram_codes blk.trigrams

    unless blk.id.is_empty:
      let lid = blk.id.to_lower
      lid.to_bigram_codes blk.trigrams
      lid.to_trigram_codes blk.trigrams

    for tag in blk.ntags:
      let ltag = tag.decode_tag.to_lower
      ltag.to_bigram_codes blk.bigrams
      ltag.to_trigram_codes blk.trigrams

    blk.bigrams_us = blk.bigrams.unique.sort
    blk.trigrams_us = blk.trigrams.unique.sort

    doc.bigrams_us.add blk.bigrams_us
    doc.trigrams_us.add blk.trigrams_us

  doc.bigrams_us = doc.bigrams_us.unique.sort
  doc.trigrams_us = doc.trigrams_us.unique.sort